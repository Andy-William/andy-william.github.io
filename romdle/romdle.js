import{wordleHash as t,calculate as e,eligibleWord as n}from"./util.js";const o=["red","yellow","green"];document.getElementById("loadBtn").addEventListener("click",c),document.getElementById("solveBtn").addEventListener("click",(function(){const o=document.getElementById("solveBtn");document.getElementById("answercontainer").style.display="flex";const l=document.getElementById("results"),r=document.getElementById("suggestions");o.disabled=!0,o.textContent="Solving...",l.innerHTML="<p>Loading...</p>",r.innerHTML="<p>Loading...</p>",setTimeout((()=>{(async function(){const o=Array.from(document.getElementById("grid").querySelectorAll(".row"));let l=[],r=[];o.forEach((t=>{let e="",n="";t.querySelectorAll(".tile").forEach(((t,o)=>{e+=t.textContent,n+=t.dataset.colorIndex})),l.push(e),r.push(n)}));let s=[];for(let t in r)for(let e=0;e<5;e++)"0"!=r[t][e]&&s.push(l[t][e]);await Promise.all(m);let c=a.filter((t=>n(t.trim(),s))).map((t=>t.trim().toUpperCase())),i=d.filter((t=>n(t.trim(),s))).map((t=>t.trim().toUpperCase())),g=[...c],h=[...i];for(let e=0;e<r.length;e++)g=g.filter((n=>t(l[e],n)==r[e])),h=h.filter((n=>t(l[e],n)==r[e]));class p{constructor(t,e,n){this.word=t,this.remaining=e,this.combination=n}static compare(t,e){return t.remaining-e.remaining||e.combination-t.combination}lte(t){return p.compare(this,t)<=0}lt(t){return p.compare(this,t)<=-1}toString(){return this.word+" - "+this.remaining+" - "+this.combination}}function f(t,n){if(0==n.length)return[];let o=e(t,n);return o=o.map((t=>new p(t[0],t[1],t[2]))),o=o.sort(((t,e)=>p.compare(t,e))),o}let y=new p("",99999,0),E=f(g,g);E.length>0&&(y=E[0]);E=E.filter((t=>t.lte(y))),console.log(E.map((t=>t.toString())));let I=f(g,c);I=I.filter((t=>t.lt(y))),I.length>0&&(y=I[0]);console.log(I.map((t=>t.toString())));let x=f(g,i);x=x.filter((t=>t.lt(y))),console.log(x.map((t=>t.toString())));let w=x.map((t=>t.word)).concat(I.map((t=>t.word))).concat(E.map((t=>t.word))),B=document.getElementById("results");u(B,g),u(document.getElementById("suggestions"),w);const C=document.createElement("div"),v=new Set(g);C.textContent="Other words that fit: "+h.filter((t=>!v.has(t))).join(", "),C.classList.add("hint"),B.appendChild(C)})().then((()=>{o.disabled=!1,o.textContent="Solve"}))}),50)}));const l=new URLSearchParams(window.location.search),r=l.get("words")||"",s=l.get("colors")||"";if(r.length>0&&(document.getElementById("guesses").value=r.match(/.{1,5}/g).join("\n"),c(),s.length>0)){let t=Array.from(s);document.querySelectorAll(".row").forEach((e=>{e.querySelectorAll(".tile").forEach((e=>{let n=t.shift();n&&(e.dataset.colorIndex=n,o.forEach((t=>e.classList.remove(t))),e.classList.add(o[n]))}))}))}function c(){const t=document.getElementById("guesses").value.trim().toUpperCase(),e=t.replace(/[^a-zA-Z]+/g,"").match(/.{5}/g)?.filter((t=>5===t.length))||[],n=document.getElementById("grid"),l=[],r=[{},{},{},{},{}];n.querySelectorAll(".row").forEach((t=>{const e=Array.from(t.querySelectorAll(".tile"));l.push(e.map(((t,e)=>{if(r[e][t.textContent]=parseInt(t.dataset.colorIndex),0!=r[e][t.textContent])for(let e=0;e<5;e++)r[e][t.textContent]&&0!=r[e][t.textContent]||(r[e][t.textContent]=1);return{letter:t.textContent,colorIndex:parseInt(t.dataset.colorIndex)}})))})),n.innerHTML="",e.forEach(((t,e)=>{const s=document.createElement("div");s.classList.add("row");for(let n=0;n<5;n++){const c=document.createElement("div"),a=l?.[e]?.[n],d=a?.letter===t[n]?a.colorIndex:r[n][t[n]]||0;c.classList.add("tile",o[d]),c.textContent=t[n],c.dataset.colorIndex=d,c.addEventListener("click",(()=>{let l=(parseInt(c.dataset.colorIndex)+1)%o.length;i(n,t[n],l,e)})),s.appendChild(c)}n.appendChild(s)})),document.getElementById("colorHint").style.display="",document.getElementById("solveBtn").style.display="block"}function i(t,e,n,l){const r=document.getElementById("grid");Array.from(r.children).forEach(((r,s)=>{if(s<l)return;let c=r.children[t];c.textContent==e&&(c.dataset.colorIndex=n,o.forEach((t=>c.classList.remove(t))),c.classList.add(o[n]))}))}let a=[],d=[],m=[fetch("romdle.txt").then((t=>t.text())).then((t=>a=t.split("\n"))),fetch("words5.txt").then((t=>t.text())).then((t=>d=t.split("\n")))];function u(t,e){t.innerHTML="",e.forEach((e=>{const n=document.createElement("div");n.textContent=e,n.classList.add("suggestion"),n.addEventListener("click",(()=>{!function(t){const e=document.getElementById("guesses");e.value=e.value+"\n"+t,c()}(e)})),t.appendChild(n)}))}
