const t=["red","yellow","green"];document.getElementById("loadBtn").addEventListener("click",l),document.getElementById("solveBtn").addEventListener("click",(function(){const t=document.getElementById("solveBtn");document.getElementById("answercontainer").style.display="flex";const e=document.getElementById("results"),n=document.getElementById("suggestions");t.disabled=!0,t.textContent="Solving...",e.innerHTML="<p>Loading...</p>",n.innerHTML="<p>Loading...</p>",setTimeout((()=>{(async function(){const t=Array.from(document.getElementById("grid").querySelectorAll(".row"));let e=[],n=[];t.forEach((t=>{let o="",l="";t.querySelectorAll(".tile").forEach(((t,e)=>{o+=t.textContent,l+=t.dataset.colorIndex})),e.push(o),n.push(l)}));let o=[];if(n.length>0){let t=n.length-1;for(let l=0;l<5;l++)"0"!=n[t][l]&&o.push(e[t][l])}function l(t){if(""==t)return!1;for(let e of o){let n=t.replace(RegExp(e,"i"),"");if(n==t)return!1;t=n}return!0}await Promise.all(s);let r=c.filter((t=>l(t.trim()))).map((t=>t.trim().toUpperCase())),d=i.filter((t=>l(t.trim()))).map((t=>t.trim().toUpperCase())),m={};function u(t,e){if(t=t.toUpperCase(),e=e.toUpperCase(),m[t]&&m[t][e])return m[t][e];m[t]=m[t]||{};let n=[0,0,0,0,0],o={};for(let l=0;l<5;l++)t[l]==e[l]?n[l]=2:o[e[l]]=(o[e[l]]||0)+1;for(let l=0;l<5;l++)t[l]!=e[l]&&o[t[l]]&&o[t[l]]>0&&(o[t[l]]--,n[l]=1);return m[t][e]=n.join("")}let g=[...r],h=[...d];for(let t=0;t<n.length;t++)g=g.filter((o=>u(e[t],o)==n[t])),h=h.filter((o=>u(e[t],o)==n[t]));function f(t,e){let n=new Array(e.length);for(let o=0;o<e.length;o++){n[o]=[e[o],0];let l={};for(let r=0;r<t.length;r++){let c=u(e[o],t[r]);l[c]=(l[c]||0)+1,"22222"==c&&l[c]--,l[c]>n[o][1]&&(n[o][1]=l[c])}n[o][2]=Object.keys(l).length}return n}class p{constructor(t,e,n){this.word=t,this.remaining=e,this.combination=n}static compare(t,e){return t.remaining-e.remaining||e.combination-t.combination}lte(t){return p.compare(this,t)<=0}lt(t){return p.compare(this,t)<=-1}toString(){return this.word+" - "+this.remaining+" - "+this.combination}}function y(t,e){if(0==e.length)return[];let n=f(t,e);return n=n.map((t=>new p(t[0],t[1],t[2]))),n=n.sort(((t,e)=>p.compare(t,e))),n}let E=new p("",99999,0),x=y(g,g);x.length>0&&(E=x[0]);x=x.filter((t=>t.lte(E))),console.log(x.map((t=>t.toString())));let I=y(g,r);I=I.filter((t=>t.lt(E))),I.length>0&&(E=I[0]);console.log(I.map((t=>t.toString())));let w=y(g,d);w=w.filter((t=>t.lt(E))),console.log(w.map((t=>t.toString())));let C=w.map((t=>t.word)).concat(I.map((t=>t.word))).concat(x.map((t=>t.word))),B=document.getElementById("results");a(B,g),a(document.getElementById("suggestions"),C);const v=document.createElement("div"),L=new Set(g);v.textContent="Other words that fit: "+h.filter((t=>!L.has(t))).join(", "),v.classList.add("hint"),B.appendChild(v)})().then((()=>{t.disabled=!1,t.textContent="Solve"}))}),50)}));const e=new URLSearchParams(window.location.search),n=e.get("words")||"",o=e.get("colors")||"";if(n.length>0&&(document.getElementById("guesses").value=n.match(/.{1,5}/g).join("\n"),l(),o.length>0)){let e=Array.from(o);document.querySelectorAll(".row").forEach((n=>{n.querySelectorAll(".tile").forEach((n=>{let o=e.shift();o&&(n.dataset.colorIndex=o,t.forEach((t=>n.classList.remove(t))),n.classList.add(t[o]))}))}))}function l(){const e=document.getElementById("guesses").value.trim().toUpperCase(),n=e.replace(/[^a-zA-Z]+/g,"").match(/.{5}/g)?.filter((t=>5===t.length))||[],o=document.getElementById("grid"),l=[],c=[{},{},{},{},{}];o.querySelectorAll(".row").forEach((t=>{const e=Array.from(t.querySelectorAll(".tile"));l.push(e.map(((t,e)=>{if(c[e][t.textContent]=parseInt(t.dataset.colorIndex),0!=c[e][t.textContent])for(let e=0;e<5;e++)c[e][t.textContent]&&0!=c[e][t.textContent]||(c[e][t.textContent]=1);return{letter:t.textContent,colorIndex:parseInt(t.dataset.colorIndex)}})))})),o.innerHTML="",n.forEach(((e,n)=>{const i=document.createElement("div");i.classList.add("row");for(let o=0;o<5;o++){const s=document.createElement("div"),a=l?.[n]?.[o],d=a?.letter===e[o]?a.colorIndex:c[o][e[o]]||0;s.classList.add("tile",t[d]),s.textContent=e[o],s.dataset.colorIndex=d,s.addEventListener("click",(()=>{let l=(parseInt(s.dataset.colorIndex)+1)%t.length;r(o,e[o],l,n)})),i.appendChild(s)}o.appendChild(i)})),document.getElementById("colorHint").style.display="",document.getElementById("solveBtn").style.display="block"}function r(e,n,o,l){const r=document.getElementById("grid");Array.from(r.children).forEach(((r,c)=>{if(c<l)return;let i=r.children[e];i.textContent==n&&(i.dataset.colorIndex=o,t.forEach((t=>i.classList.remove(t))),i.classList.add(t[o]))}))}let c=[],i=[],s=[fetch("romdle.txt").then((t=>t.text())).then((t=>c=t.split("\n"))),fetch("words5.txt").then((t=>t.text())).then((t=>i=t.split("\n")))];function a(t,e){t.innerHTML="",e.forEach((e=>{const n=document.createElement("div");n.textContent=e,n.classList.add("suggestion"),n.addEventListener("click",(()=>{!function(t){const e=document.getElementById("guesses");e.value=e.value+"\n"+t,l()}(e)})),t.appendChild(n)}))}
