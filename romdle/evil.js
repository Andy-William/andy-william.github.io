import{wordleHash as t,calculate as e,eligibleWord as n}from"./util.js";const i=5,r=6;let o=[],l=0,a=!1,s=!1,c=[],m=[],d=[],u=[],f=[fetch("romdle.txt").then((t=>t.text())).then((t=>m=t.split("\n").filter((t=>t.trim())).map((t=>t.trim().toUpperCase())))),fetch("words5.txt").then((t=>t.text())).then((t=>d=t.split("\n").filter((t=>t.trim())).map((t=>t.trim().toUpperCase())))),fetch("evil.txt").then((t=>t.text())).then((t=>u=t.split("\n").filter((t=>t.trim())).map((t=>t.trim().toUpperCase()))))];const h=document.getElementById("board"),g=document.getElementById("guessInput");document.getElementById("resetBtn").addEventListener("click",v);const p=document.getElementById("errorSubmit");async function v(){l=0,a=!1,s=!1,c=[],g.value="",g.focus(),p.textContent="",function(){h.innerHTML="";for(let t=0;t<r;t++){const e=document.createElement("div");e.className="row";for(let n=0;n<i;n++){const i=document.createElement("div");i.className="tile gray",i.textContent="",i.dataset.row=t,i.dataset.col=n,e.appendChild(i)}h.appendChild(e)}}(),await Promise.all(f),o=[...u]}class w{constructor(t,e,n){this.word=t,this.remaining=e,this.combination=n}static compare(t,e){return t.remaining-e.remaining||e.combination-t.combination}}function y(t,n){if(0==n.length)return[];let i=e(t,n);return i=i.map((t=>new w(t[0],t[1],t[2]))),i=i.sort(((t,e)=>w.compare(t,e))),i[0]}function C(t,e,n,i,o){if(s)return!1;if(l>0&&4==o.length){if(i.every((t=>t.endsWith("OWER")))&&i.filter((t=>"ROWER"!=t)).length>r-l-1)return s=!0,!0;if(i.every((t=>t.endsWith("OUND")))&&i.length>r-l-1)return s=!0,!0;if(i.every((t=>t.endsWith("IDER")))&&i.filter((t=>"RIDER"!=t)).length>r-l-1)return s=!0,!0}if(e.remaining>t.remaining)return!0;if(e.remaining<t.remaining)return!1;if(e.remaining>1&&l>0){if(e.combination<t.combination)return!0;if(e.combination>t.combination)return!1}return i.length>n.length}function x(e){if(a)return;if((e=e.toUpperCase()).length!==i)return void(p.textContent="Invalid word length!");if(!n(e,c))return void(p.textContent="Must contain "+Array.from(new Set(c)).join(", ")+"!");if(!d.includes(e)&&!m.includes(e))return void(p.textContent="Not in word list!");p.textContent="";const u=document.querySelectorAll(`.row:nth-child(${l+1}) .tile`);let f=function(e,i){let r={},a=0,u=new w("",-1,0),f="22222";s=!1;for(let n of i){let i=t(e,n);r[i]||=[],r[i].push(n)}for(let t in r){if(r[t].length<a)continue;if("22222"==t)continue;let i=[];for(let n in t)"0"!=t[n]&&i.push(e[n]);let o=d.filter((t=>n(t.trim(),i))).map((t=>t.trim().toUpperCase())),l=y(r[t],o);C(u,l,r[f],r[t],i)&&(u=l,f=t,a=u.remaining,c=i)}return o=0==l?m.filter((n=>t(e,n)==f)):r[f],f}(e,o);for(let t=0;t<f.length;t++)u[t].textContent=e[t],u[t].classList.remove("red","yellow","green","gray"),"2"==f[t]?u[t].classList.add("green"):"1"==f[t]?u[t].classList.add("yellow"):u[t].classList.add("red");l++,"22222"==f?(a=!0,p.textContent="You win!"):l>=r&&(a=!0,p.textContent=`Game over! The word was ${o[0]}`),g.value=""}g.addEventListener("keydown",(t=>{"Enter"===t.key&&x(g.value)})),v();
